import{_,r as g,d as m,g as I,s as y,c as r,b as t,w as d,i as u,f as b,t as p,F as T,e as V,h as k,o as v,v as f,p as S,j as x,k as C}from"./index-sJdot677.js";const U={data(){return{invoices:[],editingInvoice:null,currentDate:new Date().toLocaleDateString("vi-VN").replace(/\//g,"_")}},methods:{fetchInvoice(e){const i=g(m,`hoadon/${this.currentDate}/${e}`);console.log("Đường dẫn đến dữ liệu:",i.toString()),I(i).then(a=>{console.log("Dữ liệu từ Firebase:",a.val()),a.exists()?(this.editingInvoice=a.val(),this.editingInvoice.id=e):alert("Hóa đơn không tìm thấy.")}).catch(a=>{alert("Lỗi khi lấy dữ liệu:",a)})},saveChanges(){if(this.editingInvoice&&this.editingInvoice.id){const e=g(m,`hoadon/${this.currentDate}/${this.editingInvoice.id}`);y(e,this.editingInvoice).then(()=>{alert("Hóa đơn đã được cập nhật thành công"),this.$router.push({name:"about"})}).catch(i=>{alert("Lỗi khi cập nhật hóa đơn:",i)})}else alert("Không thể cập nhật hóa đơn. ID không hợp lệ.")},cancelEdit(){this.$router.push({name:"about"})},removeProduct(e){this.editingInvoice.sanPham.splice(e,1),this.updateTotalAmount()},addProduct(){this.editingInvoice.sanPham.push({tenSp:"",dvt:"",sl:0,gia:0,thanhtien:0})},updateTotalAmount(){this.editingInvoice.tongTien=this.editingInvoice.sanPham.reduce((e,i)=>e+i.thanhtien,0)},calculateTotal(e){e.thanhtien=e.sl*e.gia,this.updateTotalAmount()}},mounted(){const e=this.$route.query.id;console.log("ID nhận được:",e),e&&this.fetchInvoice(e)}},h=e=>(S("data-v-d8b96b48"),e=e(),x(),e),w={key:0},D=h(()=>t("h2",null,"Chỉnh sửa hóa đơn",-1)),P=h(()=>t("strong",null,"Khách hàng: ",-1)),H=h(()=>t("strong",null,"Ngày:",-1)),L=h(()=>t("thead",null,[t("tr",null,[t("th",null,"STT"),t("th",null,"Tên SP"),t("th",null,"ĐVT"),t("th",{style:{width:"35px !important"}},"SL"),t("th",{style:{width:"35px !important"}},"Giá"),t("th",null,"TT"),t("th",null,"----")])],-1)),N=["onUpdate:modelValue"],B=["onUpdate:modelValue"],E=C('<option value="Thùng" data-v-d8b96b48>T</option><option value="Gói" data-v-d8b96b48>G</option><option value="Hộp" data-v-d8b96b48>H</option><option value="Cái" data-v-d8b96b48>C</option><option value="Bịch" data-v-d8b96b48>B</option>',5),A=[E],F=["onUpdate:modelValue","onInput"],G=["onUpdate:modelValue","onInput"],K=["onUpdate:modelValue"],M=["onClick"],R=h(()=>t("strong",null,"Tổng tiền:",-1)),j={class:"actions"};function q(e,i,a,X,s,l){return s.editingInvoice?(v(),r("div",w,[D,t("p",null,[P,d(t("input",{style:{border:"1px solid gainsboro","border-radius":"4px"},"onUpdate:modelValue":i[0]||(i[0]=n=>s.editingInvoice.khachHang=n),class:"customer-input"},null,512),[[u,s.editingInvoice.khachHang]])]),t("p",null,[H,b(" "+p(s.editingInvoice.ngay),1)]),t("table",null,[L,t("tbody",null,[(v(!0),r(T,null,V(s.editingInvoice.sanPham,(n,c)=>(v(),r("tr",{key:c},[t("td",null,p(c+1),1),t("td",null,[d(t("input",{style:{width:"140px !important"},"onUpdate:modelValue":o=>n.tenSp=o,placeholder:"Tên sản phẩm",class:"tb-input"},null,8,N),[[u,n.tenSp]])]),t("td",null,[d(t("select",{"onUpdate:modelValue":o=>n.dvt=o,class:"tb-input"},A,8,B),[[f,n.dvt]])]),t("td",null,[d(t("input",{"onUpdate:modelValue":o=>n.sl=o,type:"number",style:{width:"35px !important"},onInput:o=>l.calculateTotal(n),class:"tb-input small-input"},null,40,F),[[u,n.sl,void 0,{number:!0}]])]),t("td",null,[d(t("input",{style:{width:"50px !important"},"onUpdate:modelValue":o=>n.gia=o,type:"number",onInput:o=>l.calculateTotal(n),class:"tb-input small-input"},null,40,G),[[u,n.gia,void 0,{number:!0}]])]),t("td",null,[d(t("input",{style:{width:"55px !important"},"onUpdate:modelValue":o=>n.thanhtien=o,type:"number",readonly:"",class:"tb-input small-input"},null,8,K),[[u,n.thanhtien,void 0,{number:!0}]])]),t("td",null,[t("button",{onClick:o=>l.removeProduct(c),class:"action-button"},"Xóa",8,M)])]))),128))])]),t("p",null,[R,b(" "+p(s.editingInvoice.tongTien),1)]),t("div",j,[t("button",{onClick:i[1]||(i[1]=(...n)=>l.addProduct&&l.addProduct(...n)),class:"action-button"},"➕"),t("button",{onClick:i[2]||(i[2]=(...n)=>l.saveChanges&&l.saveChanges(...n)),class:"action-button"},"Lưu thay đổi"),t("button",{onClick:i[3]||(i[3]=(...n)=>l.cancelEdit&&l.cancelEdit(...n)),class:"action-button"},"Hủy")])])):k("",!0)}const J=_(U,[["render",q],["__scopeId","data-v-d8b96b48"]]);export{J as default};
