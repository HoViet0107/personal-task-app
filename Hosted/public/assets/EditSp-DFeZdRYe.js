import{_ as I,r as m,g as y,d as _,s as T,c as p,b as t,w as d,i as u,f as b,t as v,F as V,e as k,h as f,o as g,v as S,p as x,j as C,k as U}from"./index-CutwGBfO.js";const w={data(){return{invoices:[],editingInvoice:null,currentDate:new Date().toLocaleDateString("vi-VN").replace(/\//g,"_")}},methods:{fetchInvoice(e,i){const h=m(_,`hoadon/${i}/${e}`);console.log("Đường dẫn đến dữ liệu:",h.toString()),y(h).then(l=>{console.log("Dữ liệu từ Firebase:",l.val()),l.exists()?(this.editingInvoice=l.val(),this.editingInvoice.id=e):alert("Hóa đơn không tìm thấy.")}).catch(l=>{alert("Lỗi khi lấy dữ liệu:",l)})},saveChanges(){if(this.editingInvoice&&this.editingInvoice.id){const e=m(_,`hoadon/${this.currentDate}/${this.editingInvoice.id}`);T(e,this.editingInvoice).then(()=>{alert("Hóa đơn đã được cập nhật thành công"),this.$router.push({name:"about"})}).catch(i=>{alert("Lỗi khi cập nhật hóa đơn:",i)})}else alert("Không thể cập nhật hóa đơn. ID không hợp lệ.")},cancelEdit(){this.$router.push({name:"about"})},removeProduct(e){this.editingInvoice.sanPham.splice(e,1),this.updateTotalAmount()},addProduct(){this.editingInvoice.sanPham.push({tenSp:"",dvt:"",sl:0,gia:0,thanhtien:0})},updateTotalAmount(){this.editingInvoice.tongTien=this.editingInvoice.sanPham.reduce((e,i)=>e+i.thanhtien,0)},calculateTotal(e){e.thanhtien=e.sl*e.gia,this.updateTotalAmount()}},mounted(){const e=this.$route.query.id,i=this.$route.query.date;console.log("ID nhận được:",e),e&&this.fetchInvoice(e,i)}},c=e=>(x("data-v-ae13d216"),e=e(),C(),e),D={key:0},P=c(()=>t("h2",null,"Chỉnh sửa hóa đơn",-1)),H=c(()=>t("strong",null,"Khách hàng: ",-1)),L=c(()=>t("strong",null,"Ngày:",-1)),N=c(()=>t("thead",null,[t("tr",null,[t("th",null,"STT"),t("th",null,"Tên SP"),t("th",null,"ĐVT"),t("th",{style:{width:"35px !important"}},"SL"),t("th",{style:{width:"35px !important"}},"Giá"),t("th",null,"TT"),t("th",null,"----")])],-1)),B=["onUpdate:modelValue"],E=["onUpdate:modelValue"],A=U('<option value="Thùng" data-v-ae13d216>T</option><option value="Gói" data-v-ae13d216>G</option><option value="Hộp" data-v-ae13d216>H</option><option value="Cái" data-v-ae13d216>C</option><option value="Bịch" data-v-ae13d216>B</option>',5),F=[A],G=["onUpdate:modelValue","onInput"],q=["onUpdate:modelValue","onInput"],K=["onUpdate:modelValue"],M=["onClick"],R=c(()=>t("strong",null,"Tổng tiền:",-1)),j={class:"actions"};function X(e,i,h,l,s,o){return s.editingInvoice?(g(),p("div",D,[P,t("p",null,[H,d(t("input",{style:{border:"1px solid gainsboro","border-radius":"4px"},"onUpdate:modelValue":i[0]||(i[0]=n=>s.editingInvoice.khachHang=n),class:"customer-input"},null,512),[[u,s.editingInvoice.khachHang]])]),t("p",null,[L,b(" "+v(s.editingInvoice.ngay),1)]),t("table",null,[N,t("tbody",null,[(g(!0),p(V,null,k(s.editingInvoice.sanPham,(n,r)=>(g(),p("tr",{key:r},[t("td",null,v(r+1),1),t("td",null,[d(t("input",{style:{width:"140px !important"},"onUpdate:modelValue":a=>n.tenSp=a,placeholder:"Tên sản phẩm",class:"tb-input"},null,8,B),[[u,n.tenSp]])]),t("td",null,[d(t("select",{"onUpdate:modelValue":a=>n.dvt=a,class:"tb-input"},F,8,E),[[S,n.dvt]])]),t("td",null,[d(t("input",{"onUpdate:modelValue":a=>n.sl=a,type:"number",style:{width:"35px !important"},onInput:a=>o.calculateTotal(n),class:"tb-input small-input"},null,40,G),[[u,n.sl,void 0,{number:!0}]])]),t("td",null,[d(t("input",{style:{width:"50px !important"},"onUpdate:modelValue":a=>n.gia=a,type:"number",onInput:a=>o.calculateTotal(n),class:"tb-input small-input"},null,40,q),[[u,n.gia,void 0,{number:!0}]])]),t("td",null,[d(t("input",{style:{width:"55px !important"},"onUpdate:modelValue":a=>n.thanhtien=a,type:"number",readonly:"",class:"tb-input small-input"},null,8,K),[[u,n.thanhtien,void 0,{number:!0}]])]),t("td",null,[t("button",{onClick:a=>o.removeProduct(r),class:"action-button"},"Xóa",8,M)])]))),128))])]),t("p",null,[R,b(" "+v(s.editingInvoice.tongTien),1)]),t("div",j,[t("button",{onClick:i[1]||(i[1]=(...n)=>o.addProduct&&o.addProduct(...n)),class:"action-button"},"➕"),t("button",{onClick:i[2]||(i[2]=(...n)=>o.saveChanges&&o.saveChanges(...n)),class:"action-button"},"Lưu thay đổi"),t("button",{onClick:i[3]||(i[3]=(...n)=>o.cancelEdit&&o.cancelEdit(...n)),class:"action-button"},"Hủy")])])):f("",!0)}const J=I(w,[["render",X],["__scopeId","data-v-ae13d216"]]);export{J as default};
